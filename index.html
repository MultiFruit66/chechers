<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="utf-8">
	<title>Chechers</title>
	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="path/to/image.jpg">
	<link rel="icon" href="img/favicon/favicon.ico">
	<link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon-180x180.png">

</head>

<body style="background-image: url(img/bg.png); 
  background-size: cover; background-repeat: repeat-y; margin: 2%">

	<canvas id="canvas"
	style="border: 3px solid grey; display: block; margin: auto; background-color: white;">
	</canvas>

	<script>
		var canvas  = document.getElementById("canvas");
		var context = canvas.getContext("2d");

		var canvasHeight = document.documentElement.clientHeight * 0.9;
		if (document.documentElement.clientHeight > document.documentElement.clientWidth) {
			canvasHeight = document.documentElement.clientWidth * 0.9;
		}
		canvasHeight > 1000 ? canvasHeight = 1000 : canvasHeight > 800 ? canvasHeight = 800 : 
		canvasHeight > 600 ? canvasHeight = 600 : canvasHeight > 400 ? canvasHeight = 400 : canvasHeight = 280;
		console.log(canvasHeight);

		canvas.setAttribute('width', canvasHeight);
		canvas.setAttribute('height', canvasHeight);
		
		var pas = 0;
		var colorPas = "green";

		var cells = 
		["A1", "C1", "E1", "G1", "B2", "D2", "F2", "H2", 
		 "A3", "C3", "E3", "G3", "B4", "D4", "F4", "H4", 
		 "A5", "C5", "E5", "G5", "B6", "D6", "F6", "H6", 
		 "A7", "C7", "E7", "G7", "B8", "D8", "F8", "H8"];
		
		for(var i in cells) {
		 	cells[i] = {
		 		positionName 	: cells[i],
		 		positionX    	: i % 8 >= 4 && i % 8 <= 8 ? 
		 		(i % 4 * canvasHeight / 4) + canvasHeight / 8 : i % 4 * canvasHeight / 4,
		 		positionY    	: i < 4 ? 0 : i < 8 ? canvasHeight / 8 : i < 12 ? canvasHeight / 4 : 
		 		i < 16 ? canvasHeight / 8 * 3 : i < 20 ? canvasHeight / 2 : 
		 		i < 24 ? canvasHeight / 8 * 5 : i < 28 ? canvasHeight / 4 * 3 : canvasHeight / 8 * 7,
		 		color        	: i < 12 ? "red" : i < 20 ? "none" : "green",
		 		queen        	: "none",
		 		active       	: "none",
		 		lines        	: []
		 	}
		}

		var lines = ["A7B8", "A5D8", "A3F8", "A1H8", "C1H6", "E1H4", 
				 "G1H2", "A3C1", "A5E1", "A7G1", "B8H2", "D8H4", "F8H6"];

		lines[0] = [cells[24],cells[28]];
		lines[1] = [cells[16],cells[20],cells[25],cells[29]];
		lines[2] = [cells[8],cells[12],cells[17],cells[21],cells[26],cells[30]];
		lines[3] = [cells[0],cells[4],cells[9],cells[13],cells[18],cells[22],cells[27],cells[31]];
		lines[4] = [cells[1],cells[5],cells[10],cells[14],cells[19],cells[23]];
		lines[5] = [cells[2],cells[6],cells[11],cells[15]];
		lines[6] = [cells[3],cells[7]];
		lines[7] = [cells[1],cells[4],cells[8]];
		lines[8] = [cells[2],cells[5],cells[9],cells[12],cells[16]];
		lines[9] = [cells[3],cells[6],cells[10],cells[13],cells[17],cells[20],cells[24]];
		lines[10] = [cells[7],cells[11],cells[14],cells[18],cells[21],cells[25],cells[28]];
		lines[11] = [cells[15],cells[19],cells[22],cells[26],cells[29]];
		lines[12] = [cells[23],cells[27],cells[30]];
		
		for (var i in cells) {
			var k = 0;
			for (var j in lines) {
				for (var l in lines[j]) {
					if(lines[j][l] === cells[i]) {			
						cells[i].lines[k] = lines[j];
						k = 1;
					}
				}
			}
		}

		drawCells();
		drawChechers();
		activeChecher();

		function drawChecher(positionX, positionY) {
			context.beginPath();
			context.arc(positionX, positionY, canvasHeight / 16, 0, Math.PI * 2);
			context.fill();
		}

		function drawChechers() {
			for(var i in cells) {
				if (cells[i].color === "green") {
					context.fillStyle = "green";
					drawChecher(cells[i].positionX + canvasHeight / 16, cells[i].positionY + canvasHeight / 16);
					if (cells[i].queen === "queen") {
						context.fillStyle = "Lime";
						drawChecher(cells[i].positionX + canvasHeight / 16, cells[i].positionY + canvasHeight / 16);
					}
				}
				else if (cells[i].color === "red") {
					context.fillStyle = "red";
					drawChecher(cells[i].positionX + canvasHeight / 16, cells[i].positionY + canvasHeight / 16);
					if (cells[i].queen === "queen") {
						context.fillStyle = "orange";
						drawChecher(cells[i].positionX + canvasHeight / 16, cells[i].positionY + canvasHeight / 16);
					}
				}
			}
		}

		function drawCell(positionX, positionY, width, height) {
			context.fillRect(positionX, positionY, width, height);
		}

		function drawCells() {
			for(var i in cells) {
				context.fillStyle = "black";
				drawCell(cells[i].positionX, cells[i].positionY, canvasHeight / 8, canvasHeight / 8);
			}
		}

		function drawBorder() {
			for(var i in cells) {
				if (cells[i].active === "active") {
					context.fillStyle = "blue";
					drawCell(cells[i].positionX - 3, cells[i].positionY - 3, 
					canvasHeight / 8 + 6, canvasHeight / 8 + 6);
				}
			}
		}

		function clearBorder() {
			var checkConditions = 0;
			for (var i in cells) {
				if (cells[i].active === "active") {
					checkConditions = 1;
				}
			}
			if (checkConditions === 0) {
				for (var i in cells) {
					context.clearRect(cells[i].positionX + canvasHeight / 8, cells[i].positionY, canvasHeight / 8, canvasHeight / 8);
					context.clearRect(cells[i].positionX - canvasHeight / 8, cells[i].positionY, canvasHeight / 8, canvasHeight / 8);
				}
			}
		}

		function activeChecher() {
			canvas.onclick = function(event) {
				for (var i in cells) {
					cells[i].active = "none";
					if (isCursorInCells(cells[i])) {
						cells[i].active = "active";
						checkConditionsList();
					}
				}
			}
		}

		function isCursorInCells(cells) {
			var x = event.offsetX;
			var y = event.offsetY;
			return x > cells.positionX && x < cells.positionX + canvasHeight / 8 && 
						 y > cells.positionY && y < cells.positionY + canvasHeight / 8;
		}

		function checkConditionsList() {
			var currentVariants = checkAttack();
			var currentVariantsQueen = checkAttackQueen();
			var checkConditions = 0;
			for (var i in cells) {
				if (cells[i].active === "active" && cells[i].color === colorPas && 
					 (checkAttack() || checkAttackQueen())) {
					for (var j in currentVariants[0]) {
						if (isCursorInCells(currentVariants[0][j]) && 
								currentVariants[0][j].queen === "none") {
							checkConditions = 1;
							attackChecher();
						}
					}
					for (var j in currentVariantsQueen[0]) {
						if (isCursorInCells(currentVariantsQueen[0][j]) && 
							currentVariantsQueen[0][j].queen === "queen") {
							checkConditions = 1;
							attackQueen();
						}
					}
					if (checkConditions === 0) {
						for (var i in cells) {
							cells[i].active = "none";
						}
						activeChecher();
					}
				}
				else if (cells[i].active === "active" && cells[i].color === colorPas) {
					checkConditions = 1;
					moveChecher();
				}
			}
			if (checkConditions === 0) {
				for (var i in cells) {
					cells[i].active = "none";
				}
				activeChecher();
			}
		}

		function moveChecher() {
			for (var i in cells) {
				if (cells[i].active === "active") {
					var currentChecher = cells[i];
				}
			}
			canvas.onclick = function(event) {
				for (var i in cells) {
					if (isCursorInCells(cells[i]) && cells[i].color === "none" &&
						  checkLines(currentChecher, cells[i]) && checkQueen(currentChecher) &&
						  ruleForQueenMove()) {
						var rule = ruleForQueenMove();
						for (var j in rule) {
							if (isCursorInCells(rule[j])) {
								cells[i].color = colorPas;
								cells[i].queen = "queen";
								pas = ++pas;
								colorPas = pas % 2 === 0 ? "green" : "red";
								currentChecher.color = "none";
								currentChecher.queen = "none";
								for (var i in cells) {
									cells[i].active = "none";
								}
								activeChecher();
							}
						}
					}
					else if (isCursorInCells(cells[i]) && cells[i].color === colorPas) {
						currentChecher = cells[i];
						for (var i in cells) {
							cells[i].active = "none";
						}
						clearBorder();
						currentChecher.active = "active";
					}
					else if (isCursorInCells(cells[i]) && cells[i].color === "none" &&
					checkLines(currentChecher, cells[i]) && rulesMoveList(currentChecher, cells[i])) {
						cells[i].color = colorPas;
						pas = ++pas;
						colorPas = pas % 2 === 0 ? "green" : "red";
						currentChecher.color = "none";
						for (var i in cells) {
							cells[i].active = "none";
						}
						activeChecher();
					}
				}
			}
		}

		function checkAttackQueen() {
			var currentVariants = [];
			var curVariants = [];
			var curVar = [];
			var currentVar = 0;
			var result = [[], [], []];
			var v1 = 0, v2 = 0, v3 = 0;
			for (var i in cells) {
				if (cells[i].queen === "queen" && cells[i].color === colorPas) {
					currentVariants[currentVar] = cells[i];
					currentVar = ++currentVar;
				}
			}
			currentVar = 0;
			for (var i in currentVariants) {
				for (var j in currentVariants[i].lines) {
					for (var currentPosition in currentVariants[i].lines[j]) {
						if (currentVariants[i].lines[j][currentPosition] === currentVariants[i]) {
							var lineLength = currentVariants[i].lines[j].length - 1;
							for (var enemyPosition = 0; enemyPosition <= lineLength; ++enemyPosition) {
								if (currentVariants[i].lines[j][enemyPosition].color !== currentVariants[0].color &&
										currentVariants[i].lines[j][enemyPosition].color !== "none") {
									var between, bigger, conditionBefore = 0, conditionAfter = 0, 
											b, n = 0, v = 0, m = [], f = [], d = [];
									enemyPosition > currentPosition ? 
									between = enemyPosition - currentPosition - 1 : 
									between = currentPosition - enemyPosition - 1;
									enemyPosition > currentPosition ? 
									bigger = enemyPosition : 
									bigger = currentPosition;
									for (var s = 1; s <= between; s++) {
										if (currentVariants[i].lines[j][bigger - s].color === "none") {
											conditionBefore = ++conditionBefore;
										}
									}
									if (currentPosition > enemyPosition) {
										var q = enemyPosition - 1;
										if (enemyPosition === 0) {
											q = 0;
										}
										if (currentVariants[i].lines[j][q].color === "none") {
											b = 0;
											for (var s = enemyPosition - 1; s >= 0; --s) {
												m[b] = s;
												b = ++b;
											}
										}
									}
									else {
										var q = enemyPosition + 1;
										if (enemyPosition === lineLength) {
											q = +enemyPosition;
										}
										if (currentVariants[i].lines[j][q].color === "none") {
											b = 0;
											for (var s = +enemyPosition + 1; s <= lineLength; ++s) {
												m[b] = s;
												b = ++b;
											}
										}
									}
									v = 0;
									curVar = 0;
									if (m.length !== 0) {
										for (var b in m) {
											if (currentVariants[i].lines[j][m[b]].color === "none") {
												d[curVar] = m[b];
												v = 1;
												curVar = ++curVar;
											}
										}
										curVar = 0;
										if (v > 0) {
											for (var u in d) {
												f[curVar] = currentVariants[i].lines[j][d[u]];	
												curVar = ++curVar;									
											}
										}
									}
 									if ((conditionBefore === between) && f.length !== 0) {
 										result[0][v1] = currentVariants[i].lines[j][currentPosition];
										v1 = ++v1;
										result[1][v2] = currentVariants[i].lines[j][enemyPosition];
										v2 = ++v2;
										result[2][v3] = f;
										v3 = ++v3;
									}
								}
							}
						}
					}
				}
			}
			if (result[0].length === 0) {
				return false;
			}
			return result;
		}

		function attackQueen() {
			var currentVariantsQueen = checkAttackQueen();
			var currentVariants = checkAttack();
			var checkConditions = 0;
			for (var i in cells) {
				if (cells[i].active === "active") {
					var currentChecher = cells[i];
				}
			}
			canvas.onclick = function(event) {
				for (var i in cells) {
					if (isCursorInCells(cells[i]) && cells[i].color === colorPas && checkConditions === 0) {
						for (var j in currentVariantsQueen[0]) {
							if (currentVariantsQueen[0][j] === cells[i]) {
								currentChecher = cells[i];
								for (var i in cells) {
									cells[i].active = "none";
								}
								clearBorder();
								currentChecher.active = "active";
							}
						}
						for (var j in currentVariants[0]) {
							if (currentVariants[0][j] === cells[i]) {
								currentChecher = cells[i];
								for (var i in cells) {
									cells[i].active = "none";
								}
								clearBorder();
								currentChecher.active = "active";
								attackChecher();
							}
						}
					}
					else if (isCursorInCells(cells[i]) && cells[i].color === "none" && checkAttackQueen()) {
						for (var j in currentVariantsQueen[2]) {
							for (var l in currentVariantsQueen[2][j]) {
								if (currentVariantsQueen[2][j][l] === cells[i] && 
										currentVariantsQueen[0][j] === currentChecher) {
									cells[i].color = colorPas;
									cells[i].queen = "queen";
									currentChecher.color = "none";
									currentChecher.queen = "none";
									currentVariantsQueen[1][j].color = "none";
									currentVariantsQueen[1][j].queen = "none";
									currentChecher = cells[i];
									currentVariantsQueen = checkAttackQueen();
									checkConditions = 0;
									if (currentVariantsQueen) {
										for (var l in currentVariantsQueen[0]){
											if (currentChecher === currentVariantsQueen[0][l]) {
												for (var i in cells) {
													cells[i].active = "none";
												}
												clearBorder();
												currentChecher.active = "active";
												checkConditions = 1;
											}
										}
									}
									if (checkConditions === 0) {
										pas = ++pas;
										colorPas = pas % 2 === 0 ? "green" : "red";
										for (var i in cells) {
											cells[i].active = "none";
										}
										activeChecher();
									}
								}
							}
						}
					}
				}
			}
		}

		function checkAttack() {
			var allVariants = checkNearEnemy();
			var result = [[], [], []];
			var currentVar = 0;
			var v1 = 0, v2 = 0, v3 = 0;
			var currentColorVariants = [];
			var enemyVariants = [];
			for (var i in allVariants) {
				if (allVariants[i].color === colorPas) {
					currentColorVariants[currentVar] = allVariants[i];
					currentVar = ++currentVar;
				}
			}
			currentVar = 0;
			for (var i in allVariants) {
				if (allVariants[i].color !== colorPas) {
					enemyVariants[currentVar] = allVariants[i];
					currentVar = ++currentVar;
				}
			}
			for (var i in currentColorVariants) {
				for (var j in currentColorVariants[i].lines) {
					for (var l in currentColorVariants[i].lines[j]) {
						if (currentColorVariants[i].lines[j][l] === currentColorVariants[i]) {
							var m = l - 1; 
							var n = +l + 1;
							var k = l - 2;
							var s = +l + 2;
							if (l == currentColorVariants[i].lines[j].length - 1) {
								n = +l;
							}
							if (l == 0) {
								m = +l;
							}
							if (l == currentColorVariants[i].lines[j].length - 2 ||
									l == currentColorVariants[i].lines[j].length - 1) {
								s = +l;
							}
							if (l == 0 || l == 1) {
								k = +l;
							}
							if (currentColorVariants[i].lines[j][m].color === enemyVariants[0].color) {
								if (currentColorVariants[i].lines[j][k].color === "none") {
									result[0][v1] = currentColorVariants[i].lines[j][l];
									v1 = ++v1;
									result[1][v2] = currentColorVariants[i].lines[j][m];
									v2 = ++v2;
									result[2][v3] = currentColorVariants[i].lines[j][k];
									v3 = ++v3;
								}
							}
							if (currentColorVariants[i].lines[j][n].color === enemyVariants[0].color) {
								if (currentColorVariants[i].lines[j][s].color === "none") {
									result[0][v1] = currentColorVariants[i].lines[j][l];
									v1 = ++v1;
									result[1][v2] = currentColorVariants[i].lines[j][n];
									v2 = ++v2;
									result[2][v3] = currentColorVariants[i].lines[j][s];
									v3 = ++v3;
								}
							}
						}
					}
				}
			}
			if (result[0].length === 0) {
				return false;
			}
			return result;
		}

		function checkNearEnemy() {
		 	var result = [];
		 	var currentVar = 0;
			for (var i in cells) {
				for (var j in cells[i].lines) {
					for (var k in cells[i].lines[j]) {
						var n = +k + 1;
						if (k == cells[i].lines[j].length - 1) {
							n = k;
						}
						if (cells[i].lines[j][k].color !== "none" && cells[i].lines[j][n].color !== "none") {
							if(cells[i].lines[j][k].color !== cells[i].lines[j][n].color) {         
								var checkCondition = 0;
								for (var m in result) {
									if (result[m] === cells[i].lines[j][k]) {
										checkCondition = 1;
									}
								}
								if (checkCondition === 0) {
									result[currentVar] = cells[i].lines[j][k];
									currentVar = ++currentVar;
								}
								checkCondition = 0;
								for (var m in result) {
									if (result[m] === cells[i].lines[j][n]) {
										checkCondition = 1;
									}
								}
								if (checkCondition === 0) {
									result[currentVar] = cells[i].lines[j][n];
									currentVar = ++currentVar;
								}
							}
						}
					}
				}
			}
			if (result.length === 0){
		 		return false;
		 	}
		 	return result;
		}

		function attackChecher() {
			var currentVariants = checkAttack();
			var currentVariantsQueen = checkAttackQueen();
			var checkConditions = 0;
			for (var i in cells) {
				if (cells[i].active === "active") {
					var currentChecher = cells[i];
				}
			}
			canvas.onclick = function(event) {
				for (var i in cells) {
					if (isCursorInCells(cells[i]) && cells[i].color === colorPas && checkConditions === 0) {
						if (currentVariantsQueen) {
							for (var j in currentVariantsQueen[0]) {
								if (currentVariantsQueen[0][j] === cells[i]) {
									currentChecher = cells[i];
									for (var i in cells) {
										cells[i].active = "none";
									}
									clearBorder();
									currentChecher.active = "active";
									attackQueen();
								}
							}
						}
						for (var j in currentVariants[0]) {
							if (currentVariants[0][j] === cells[i]) {
								currentChecher = cells[i];
								for (var i in cells) {
									cells[i].active = "none";
								}
								clearBorder();
								currentChecher.active = "active";
							}
						}
					}
					else if (isCursorInCells(cells[i]) && currentChecher.queen === "queen") {
						var currentVariantsQueen = checkAttackQueen();
						if (currentVariantsQueen) {
							for (var l in currentVariantsQueen[0]){
								if (currentChecher === currentVariantsQueen[0][l]) {
									for (var j in currentVariantsQueen[2]) {
										for (var l in currentVariantsQueen[2][j]) {
											if (currentVariantsQueen[2][j][l] === cells[i] && 
													currentVariantsQueen[0][j] === currentChecher) {
												cells[i].color = colorPas;
												cells[i].queen = "queen";
												currentChecher.color = "none";
												currentChecher.queen = "none";
												currentVariantsQueen[1][j].color = "none";
												currentVariantsQueen[1][j].queen = "none";
												currentChecher = cells[i];
												currentVariantsQueen = checkAttackQueen();
												checkConditions = 0;
												if (currentVariantsQueen) {
													for (var l in currentVariantsQueen[0]){
														if (currentChecher === currentVariantsQueen[0][l]) {
															for (var i in cells) {
																cells[i].active = "none";
															}
															clearBorder();
															currentChecher.active = "active";
															checkConditions = 1;
														}
													}
												}
												if (checkConditions === 0) {
													pas = ++pas;
													colorPas = pas % 2 === 0 ? "green" : "red";
													for (var i in cells) {
														cells[i].active = "none";
													}
													activeChecher();
												}
											}
										}
									}
								}
							}
						}
					}
					else if (isCursorInCells(cells[i]) && cells[i].color === "none") {
						for (var j in currentVariants[2]) {
							if (currentVariants[2][j] === cells[i] && currentVariants[0][j] === currentChecher) {
								cells[i].color = colorPas;
								currentChecher.color = "none";
								currentVariants[1][j].color = "none";
								currentVariants[1][j].queen = "none";
								currentChecher = cells[i];
								currentVariants = checkAttack();
								checkConditions = 0;
								if (currentVariants) {
									for (var l in currentVariants[0]){
										if (currentChecher === currentVariants[0][l]) {
											for (var i in cells) {
												cells[i].active = "none";
											}
											clearBorder();
											currentChecher.active = "active";
											checkConditions = 1;
										}
									}
								}
								if (checkConditions === 0) {
									pas = ++pas;
									colorPas = pas % 2 === 0 ? "green" : "red";
									for (var i in cells) {
										cells[i].active = "none";
									}
									activeChecher();
								}
							}
						}
					}
				}
			}
		}

		function positionsDifference(currentChecher, cells) {
			return checkCurrentPosition(currentChecher, cells) - 
			checkSecondPosition(currentChecher, cells);
		}

		function checkSecondPosition(currentChecher, cells) {
			var currentLine = checkLines(currentChecher, cells);
			for (var i in currentLine) {
				if (currentLine[i] === cells) {
					return i;
				}
			}
		}

		function checkCurrentPosition(currentChecher, cells) {
			var currentLine = checkLines(currentChecher, cells);
			for (var i in currentLine) {
				if (currentLine[i] === currentChecher) {
					return i;
				}
			}
		}

		function checkLines(currentChecher, cells) {
			for (var i in currentChecher.lines) {
				for (var j in cells.lines) {
					if(currentChecher.lines[i] === cells.lines[j]) {
						return currentChecher.lines[i];
					}
				}
			}
			return false;
		}

		function checkQueen(currentChecher) {
			if (currentChecher.queen === "none") {
				return false;
			}
			return true;
		}

		function checkQueenPositions() {
			for (var i = 0; i < 4; i++) {
				if (cells[i].color === "green") {
					cells[i].queen = "queen";
				}
			}
			for (var i = 28; i < 32; i++) {
				if (cells[i].color === "red") {
					cells[i].queen = "queen";
				}
			}
		}

		function rulesMoveList(currentChecher, cells) {
			if (positionsDifference(currentChecher, cells) === 1 ||
					positionsDifference(currentChecher, cells) === -1) {
				if (currentChecher.color === "red") {
					return positionsDifference(currentChecher, cells) === -1;
				}
				else if (currentChecher.color === "green") {
					return positionsDifference(currentChecher, cells) === 1;
				}
			}
		}

		function ruleForQueenMove() {
			var result = [];
			var currentVar = 0;
			var checkConditions = 0;
			for (var i in cells) {
				if (cells[i].active === "active") {
					for (var j in cells[i].lines) {
						for (var l in cells[i].lines[j]) {
							if (cells[i].lines[j][l] === cells[i]) {
								for (var k = l - 1; k >= 0; --k) {
									if (cells[i].lines[j][k].color === "none" && checkConditions === 0) {
										result[currentVar] = cells[i].lines[j][k];
										currentVar = ++currentVar;
									}
									else {
										checkConditions = 1;
									}
								}
								checkConditions = 0;
								for (var p = +l + 1; p <= cells[i].lines[j].length - 1; ++p) {
									if (cells[i].lines[j][p].color === "none" && checkConditions === 0) {
										result[currentVar] = cells[i].lines[j][p];
										currentVar = ++currentVar;
									}
									else {
										checkConditions = 1;
									}
								}
							}
						}
					}
				}
			}
			if (result.length === 0) {
				return false;
			}
			return result;
		}


		setInterval(function () {
			checkQueenPositions();
			clearBorder();
			drawBorder();
			drawCells();
			drawChechers();1
		}, 100)

	</script>
</body>
</html>
